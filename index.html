import React, { useState, useEffect } from 'react';
import { Clock, Lightbulb, Lock, CheckCircle, XCircle, Key, Trophy, BookOpen } from 'lucide-react';

export default function EscapeGame() {
  const TEMPS_PAR_ROOM = 600;
  
  const [ecran, setEcran] = useState('accueil');
  const [roomActuelle, setRoomActuelle] = useState(0);
  const [temps, setTemps] = useState(TEMPS_PAR_ROOM);
  const [enigmeActuelle, setEnigmeActuelle] = useState(0);
  const [enigmesSelectionnees, setEnigmesSelectionnees] = useState([]);
  const [reponse, setReponse] = useState('');
  const [erreur, setErreur] = useState(false);
  const [enigmesResolues, setEnigmesResolues] = useState([false, false, false, false]);
  const [indiceAffiche, setIndiceAffiche] = useState(false);
  const [codesRooms, setCodesRooms] = useState([]);
  const [codeEntree, setCodeEntree] = useState('');
  const [erreurCode, setErreurCode] = useState(false);
  const [messageDecrypte, setMessageDecrypte] = useState('');
  const [tempsTotal, setTempsTotal] = useState(0);
  const [chiffrementSelectionne, setChiffrementSelectionne] = useState(null);

  // ==========================================
  // BANQUE DE QUESTIONS - 4 TH√àMES x 25 QUESTIONS
  // ==========================================
  const banqueEnigmes = {
    // ROOM 1: √âVOLUTION TECHNOLOGIQUE (25 questions - Mat√©riaux + Innovation)
    evolution: [
      { question: "Quelle innovation a permis de passer du t√©l√©phone fixe au mobile ?", reponse: "portabilite", indice: "Ce qui permet de d√©placer", type: "text" },
      { question: "En quelle ann√©e le premier iPhone est-il sorti ?", reponse: "2007", indice: "Entre 2000 et 2010", type: "number" },
      { question: "Comment appelle-t-on une innovation qui change radicalement un march√© ?", reponse: "rupture", indice: "Innovation de...", type: "text" },
      { question: "Quelle est la famille de mat√©riaux la plus l√©g√®re ?", reponse: "plastique", indice: "D√©riv√© du p√©trole", type: "text" },
      { question: "Quel mat√©riau est issu d'un arbre ?", reponse: "bois", indice: "Mat√©riau naturel", type: "text" },
      { question: "Comment appelle-t-on le m√©lange de fer et de carbone ?", reponse: "acier", indice: "Alliage m√©tallique", type: "text" },
      { question: "Combien y a-t-il de grandes familles de mat√©riaux ?", reponse: "4", indice: "M√©taux, plastiques...", type: "number" },
      { question: "Quel mat√©riau conduit le mieux l'√©lectricit√© ?", reponse: "cuivre", indice: "M√©tal orang√©", type: "text" },
      { question: "Quel mat√©riau est recyclable √† l'infini ?", reponse: "aluminium", indice: "M√©tal l√©ger", type: "text" },
      { question: "Comment s'appelle l'√©volution qui prend en compte l'environnement ?", reponse: "durable", indice: "D√©veloppement...", type: "text" },
      { question: "Quel objet a remplac√© le walkman ?", reponse: "smartphone", indice: "T√©l√©phone intelligent", type: "text" },
      { question: "Combien de g√©n√©rations de t√©l√©phones mobiles existe-t-il ?", reponse: "5", indice: "On parle de 5G", type: "number" },
      { question: "Quel mat√©riau est transparent et cassant ?", reponse: "verre", indice: "Pour les fen√™tres", type: "text" },
      { question: "Quel m√©tal ne rouille pas ?", reponse: "inox", indice: "Acier inoxydable", type: "text" },
      { question: "Comment appelle-t-on un objet qui se connecte √† Internet ?", reponse: "connecte", indice: "Objet...", type: "text" },
      { question: "Quelle propri√©t√© mesure la r√©sistance √† la d√©formation ?", reponse: "durete", indice: "√âchelle de Mohs", type: "text" },
      { question: "Quel mat√©riau composite est utilis√© dans les avions ?", reponse: "carbone", indice: "Fibre de...", type: "text" },
      { question: "√Ä quelle temp√©rature fond l'aluminium (en ¬∞C) ?", reponse: "660", indice: "Entre 600 et 700", type: "number" },
      { question: "Comment appelle-t-on un mat√©riau isolant √©lectrique ?", reponse: "isolant", indice: "Contraire de conducteur", type: "text" },
      { question: "Quel mat√©riau biod√©gradable remplace le plastique ?", reponse: "bioplastique", indice: "Bio + plastique", type: "text" },
      { question: "En quelle ann√©e a √©t√© cr√©√© le premier ordinateur personnel ?", reponse: "1981", indice: "Ann√©es 1980", type: "number" },
      { question: "Qui a invent√© le World Wide Web ?", reponse: "berners", indice: "Tim Berners-...", type: "text" },
      { question: "Quel pourcentage de plastiques est recycl√© en France ?", reponse: "26", indice: "Entre 20 et 30%", type: "number" },
      { question: "Comment s'appelle le proc√©d√© de chauffage du verre ?", reponse: "trempe", indice: "Verre tremp√©", type: "text" },
      { question: "Quelle invention a permis le streaming vid√©o ?", reponse: "internet", indice: "R√©seau mondial", type: "text" }
    ],

    // ROOM 2: CYBERS√âCURIT√â (25 questions - Informatique + S√©curit√©)
    cybersecurite: [
      { question: "Comment appelle-t-on un programme malveillant ?", reponse: "virus", indice: "Comme une maladie", type: "text" },
      { question: "Combien de caract√®res min pour un mot de passe s√ªr ?", reponse: "12", indice: "Plus de 10", type: "number" },
      { question: "Comment s'appelle l'usurpation d'identit√© par email ?", reponse: "phishing", indice: "Commence par 'ph'", type: "text" },
      { question: "Quelle technique crypte un fichier ?", reponse: "chiffrement", indice: "Rendre illisible", type: "text" },
      { question: "Comment appelle-t-on les traces sur Internet ?", reponse: "numeriques", indice: "Traces...", type: "text" },
      { question: "Quel protocole s√©curise les sites web ?", reponse: "https", indice: "HTTP + S", type: "text" },
      { question: "Combien d'octets dans 1 kilooctet ?", reponse: "1024", indice: "Un peu plus de 1000", type: "number" },
      { question: "Quelle loi prot√®ge les donn√©es en Europe ?", reponse: "rgpd", indice: "4 lettres", type: "text" },
      { question: "Comment appelle-t-on l'authentification en deux √©tapes ?", reponse: "double", indice: "Authentification...", type: "text" },
      { question: "Que signifie CPU ?", reponse: "processeur", indice: "Cerveau de l'ordinateur", type: "text" },
      { question: "Combien de bits dans un octet ?", reponse: "8", indice: "Moins de 10", type: "number" },
      { question: "Comment s'appelle la m√©moire temporaire ?", reponse: "ram", indice: "3 lettres", type: "text" },
      { question: "Quel langage utilise des blocs visuels ?", reponse: "scratch", indice: "Pour d√©butants", type: "text" },
      { question: "Comment s'appelle l'adresse d'un site web ?", reponse: "url", indice: "3 lettres", type: "text" },
      { question: "Combien de valeurs pour un bit ?", reponse: "2", indice: "0 et 1", type: "number" },
      { question: "Comment s'appelle un r√©seau local ?", reponse: "lan", indice: "Local Area Network", type: "text" },
      { question: "Comment s'appelle le stockage en ligne ?", reponse: "cloud", indice: "Nuage en anglais", type: "text" },
      { question: "Combien de Mo dans 1 Go ?", reponse: "1000", indice: "Environ 1000", type: "number" },
      { question: "Comment s'appelle un logiciel espion ?", reponse: "spyware", indice: "Spy = espion", type: "text" },
      { question: "Quel type d'attaque sature un serveur ?", reponse: "ddos", indice: "4 lettres", type: "text" },
      { question: "Comment s'appelle un pare-feu en anglais ?", reponse: "firewall", indice: "Fire + wall", type: "text" },
      { question: "Comment s'appelle un logiciel ran√ßonneur ?", reponse: "ransomware", indice: "Ransom = ran√ßon", type: "text" },
      { question: "Quel protocole transf√®re des pages web ?", reponse: "http", indice: "4 lettres", type: "text" },
      { question: "Comment s'appelle un r√©seau priv√© virtuel ?", reponse: "vpn", indice: "3 lettres", type: "text" },
      { question: "Quel appareil connecte plusieurs ordinateurs ?", reponse: "switch", indice: "Commutateur", type: "text" }
    ],

    // ROOM 3: D√âVELOPPEMENT DURABLE (25 questions - √ânergies + Environnement)
    durable: [
      { question: "Combien de piliers du d√©veloppement durable ?", reponse: "3", indice: "√âconomique, social...", type: "number" },
      { question: "Sur combien est not√© l'indice de r√©parabilit√© ?", reponse: "10", indice: "Comme une note", type: "number" },
      { question: "Quel m√©tal pr√©cieux dans les smartphones ?", reponse: "or", indice: "M√©tal jaune", type: "text" },
      { question: "Quelle √©nergie provient du soleil ?", reponse: "solaire", indice: "√ânergie...", type: "text" },
      { question: "Comment s'appelle l'√©nergie du vent ?", reponse: "eolienne", indice: "√ânergie...", type: "text" },
      { question: "Combien d'√©nergies renouvelables principales ?", reponse: "5", indice: "Solaire, √©olien...", type: "number" },
      { question: "Quelle √©nergie utilise la force de l'eau ?", reponse: "hydraulique", indice: "Barrages", type: "text" },
      { question: "Comment s'appelle l'√©nergie de la Terre ?", reponse: "geothermique", indice: "G√©o = Terre", type: "text" },
      { question: "Combien de litres d'eau pour fabriquer un jean ?", reponse: "7500", indice: "Entre 7000 et 8000", type: "number" },
      { question: "Comment s'appelle le cycle de vie d'un produit ?", reponse: "berceau", indice: "Du... au tombeau", type: "text" },
      { question: "Quel gaz √† effet de serre principal ?", reponse: "co2", indice: "Formule chimique", type: "text" },
      { question: "Combien d'ann√©es pour d√©grader une bouteille plastique ?", reponse: "450", indice: "Entre 400 et 500", type: "number" },
      { question: "Comment appelle-t-on l'√©nergie qui se renouvelle ?", reponse: "renouvelable", indice: "√ânergie...", type: "text" },
      { question: "Quel label garantit une production √©cologique ?", reponse: "ecolabel", indice: "√âco + label", type: "text" },
      { question: "Combien de Watts consomme une ampoule LED ?", reponse: "10", indice: "Moins de 15W", type: "number" },
      { question: "Quelle unit√© mesure l'√©nergie ?", reponse: "joule", indice: "Symbole : J", type: "text" },
      { question: "Comment s'appelle la transformation solaire en √©lectricit√© ?", reponse: "photovoltaique", indice: "Photo = lumi√®re", type: "text" },
      { question: "Quel pourcentage de l'√©lectricit√© fran√ßaise est nucl√©aire ?", reponse: "70", indice: "Environ 70%", type: "number" },
      { question: "Quelle est l'unit√© de puissance ?", reponse: "watt", indice: "Symbole : W", type: "text" },
      { question: "Combien de degr√©s max selon l'Accord de Paris ?", reponse: "2", indice: "R√©chauffement", type: "number" },
      { question: "Comment s'appelle l'√©nergie stock√©e en hauteur ?", reponse: "potentielle", indice: "√ânergie...", type: "text" },
      { question: "Quelle √©nergie produit un v√©lo en mouvement ?", reponse: "cinetique", indice: "√ânergie du mouvement", type: "text" },
      { question: "Quel combustible fossile est le plus utilis√© ?", reponse: "petrole", indice: "Or noir", type: "text" },
      { question: "Comment s'appelle l'√©nergie des aliments ?", reponse: "chimique", indice: "√ânergie...", type: "text" },
      { question: "Quelle est la tension du r√©seau fran√ßais (en V) ?", reponse: "230", indice: "Entre 220 et 240", type: "number" }
    ],

    // ROOM 4: EXP√âRIENCE UTILISATEUR (25 questions - Fonctions + Programmation)
    utilisateur: [
      { question: "Comment s'appelle l'√©tude de l'adaptation √† l'humain ?", reponse: "ergonomie", indice: "Science du confort", type: "text" },
      { question: "Combien de clics max pour acc√©der √† une info ?", reponse: "3", indice: "R√®gle des ... clics", type: "number" },
      { question: "Comment s'appelle le document qui liste les exigences ?", reponse: "cahier", indice: "... des charges", type: "text" },
      { question: "Quelle couleur pour les boutons de validation ?", reponse: "vert", indice: "Feu pour avancer", type: "text" },
      { question: "Quelle fonction permet de ralentir un v√©lo ?", reponse: "freiner", indice: "Fonction de...", type: "text" },
      { question: "Comment s'appelle la fonction qui guide ?", reponse: "diriger", indice: "Volant, guidon", type: "text" },
      { question: "Quelle fonction permet de voir la nuit ?", reponse: "eclairer", indice: "Phares", type: "text" },
      { question: "Combien de fonctions dans un v√©lo ?", reponse: "5", indice: "Propulser, diriger...", type: "number" },
      { question: "Comment s'appelle le syst√®me de transmission ?", reponse: "transmission", indice: "Cha√Æne, engrenages", type: "text" },
      { question: "Comment s'appelle le mouvement circulaire ?", reponse: "rotation", indice: "Tourner", type: "text" },
      { question: "Comment s'appelle une instruction qui se r√©p√®te ?", reponse: "boucle", indice: "For, while", type: "text" },
      { question: "Quelle structure fait un choix ?", reponse: "si", indice: "Instruction if", type: "text" },
      { question: "Comment s'appelle une suite d'instructions ?", reponse: "algorithme", indice: "M√©thode", type: "text" },
      { question: "Combien de valeurs pour une variable bool√©enne ?", reponse: "2", indice: "Vrai ou faux", type: "number" },
      { question: "Comment s'appelle un bloc r√©utilisable ?", reponse: "fonction", indice: "Sous-programme", type: "text" },
      { question: "Quel capteur mesure la distance ?", reponse: "ultrason", indice: "Ultrasons", type: "text" },
      { question: "Comment s'appelle la carte Arduino ?", reponse: "microcontroleur", indice: "Mini-ordinateur", type: "text" },
      { question: "Combien de broches num√©riques sur Arduino Uno ?", reponse: "14", indice: "Entre 10 et 20", type: "number" },
      { question: "Quelle fonction d√©marre Arduino ?", reponse: "setup", indice: "Initialisation", type: "text" },
      { question: "Comment s'appelle la boucle principale Arduino ?", reponse: "loop", indice: "Se r√©p√®te", type: "text" },
      { question: "Quel composant √©met de la lumi√®re ?", reponse: "led", indice: "Diode", type: "text" },
      { question: "Quel symbole pour l'√©galit√© en programmation ?", reponse: "==", indice: "Deux √©gal", type: "text" },
      { question: "Valeur max PWM sur Arduino ?", reponse: "255", indice: "8 bits", type: "number" },
      { question: "Comment s'appelle le logiciel Arduino ?", reponse: "ide", indice: "Environnement", type: "text" },
      { question: "Comment s'appelle le premier mod√®le d'un projet ?", reponse: "prototype", indice: "Premier exemplaire", type: "text" }
    ]
  };

  const roomsConfig = [
    { nom: "√âvolution Technologique", theme: "evolution", couleur: "from-purple-900 via-blue-900", icone: "üî¨" },
    { nom: "Cybers√©curit√©", theme: "cybersecurite", couleur: "from-red-900 via-orange-900", icone: "üîê" },
    { nom: "D√©veloppement Durable", theme: "durable", couleur: "from-green-900 via-emerald-900", icone: "üåç" },
    { nom: "Exp√©rience Utilisateur", theme: "utilisateur", couleur: "from-blue-900 via-cyan-900", icone: "üë§" },
    { nom: "D√©cryptage Final", theme: "crypto", couleur: "from-amber-900 via-yellow-900", icone: "üîë" }
  ];

  const systemesCodeage = [
    {
      id: 'cesar',
      nom: 'Chiffre de C√©sar',
      description: 'D√©calage de chaque lettre dans l\'alphabet d\'un nombre fixe de positions.',
      exemple: 'A ‚Üí D (d√©calage +3) ou B ‚Üí A (d√©calage -1)',
      correct: true
    },
    {
      id: 'atbash',
      nom: 'Chiffre Atbash',
      description: 'Inversion de l\'alphabet : A devient Z, B devient Y, etc.',
      exemple: 'A ‚Üí Z, B ‚Üí Y, C ‚Üí X',
      correct: false
    },
    {
      id: 'morse',
      nom: 'Code Morse',
      description: 'Codage en points et traits. Chaque lettre a une combinaison unique.',
      exemple: 'A = .- , B = -... , S = ...',
      correct: false
    },
    {
      id: 'binaire',
      nom: 'Code Binaire',
      description: 'Codage en 0 et 1. Chaque lettre correspond √† 8 bits.',
      exemple: 'A = 01000001, B = 01000010',
      correct: false
    }
  ];

  const tirerEnigmes = (theme) => {
    const banque = [...banqueEnigmes[theme]];
    return banque.sort(() => Math.random() - 0.5).slice(0, 4);
  };

  const genererCode = (index) => {
    const prefixes = ['EVO', 'CYB', 'DUR', 'UX', 'CRY'];
    return prefixes[index] + Math.floor(1000 + Math.random() * 9000);
  };

  useEffect(() => {
    if (ecran === 'room' && temps > 0) {
      const timer = setInterval(() => {
        setTemps(t => t - 1);
        setTempsTotal(tt => tt + 1);
      }, 1000);
      return () => clearInterval(timer);
    }
  }, [ecran, temps]);

  const formatTemps = (s) => {
    const mins = Math.floor(s / 60);
    const secs = s % 60;
    return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
  };

  const resetGame = () => {
    setEcran('accueil');
    setRoomActuelle(0);
    setCodesRooms([]);
    setTempsTotal(0);
    setChiffrementSelectionne(null);
  };

  const demarrerJeu = () => {
    setCodesRooms([0, 1, 2, 3, 4].map(i => genererCode(i)));
    demarrerRoom(0);
  };

  const demarrerRoom = (index) => {
    if (index === 4) {
      setRoomActuelle(index);
      setTemps(TEMPS_PAR_ROOM);
      setEcran('room5Crypto');
    } else {
      setEnigmesSelectionnees(tirerEnigmes(roomsConfig[index].theme));
      setRoomActuelle(index);
      setEnigmeActuelle(0);
      setEnigmesResolues([false, false, false, false]);
      setTemps(TEMPS_PAR_ROOM);
      setReponse('');
      setErreur(false);
      setIndiceAffiche(false);
      setEcran('room');
    }
  };

  const verifierReponse = () => {
    const enigme = enigmesSelectionnees[enigmeActuelle];
    if (reponse.toLowerCase().trim() === enigme.reponse.toLowerCase()) {
      const newResolues = [...enigmesResolues];
      newResolues[enigmeActuelle] = true;
      setEnigmesResolues(newResolues);
      setErreur(false);
      if (newResolues.every(r => r)) {
        setTimeout(() => setEcran('codeRoom'), 1000);
      } else {
        setTimeout(() => {
          setEnigmeActuelle(enigmeActuelle + 1);
          setReponse('');
          setIndiceAffiche(false);
        }, 1000);
      }
    } else {
      setErreur(true);
    }
  };

  const verifierCodeEntree = () => {
    if (codeEntree.toUpperCase() === codesRooms[roomActuelle]) {
      setCodeEntree('');
      setErreurCode(false);
      roomActuelle < 4 ? demarrerRoom(roomActuelle + 1) : setEcran('messageFinal');
    } else {
      setErreurCode(true);
    }
  };

  const essayerSysteme = (systemeId) => {
    const systeme = systemesCodeage.find(s => s.id === systemeId);
    if (systeme.correct) {
      setEcran('messageFinal');
    } else {
      alert("‚ùå Ce n'est pas le bon syst√®me de codage ! Essayez-en un autre.");
    }
  };

  const decrypterMessage = () => {
    if (messageDecrypte.toLowerCase().trim() === "bravo vous avez maitrise la technologie") {
      setEcran('victoire');
    } else {
      alert("Ce n'est pas la bonne r√©ponse. R√©essayez !");
    }
  };

  if (ecran === 'accueil') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-black flex items-center justify-center p-4">
        <div className="max-w-4xl w-full bg-black/60 backdrop-blur-xl rounded-3xl p-8 border border-purple-500/40 shadow-2xl">
          <h1 className="text-6xl font-bold text-center mb-6 bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
            üéØ Escape Game Technologie
          </h1>
          <p className="text-xl text-center text-gray-300 mb-6">
            4 rooms th√©matiques + 1 d√©fi de d√©cryptage final !
          </p>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-4 my-6">
            {roomsConfig.map((room, i) => (
              <div key={i} className={'bg-gradient-to-r ' + room.couleur + ' to-black p-4 rounded-lg border border-white/20 hover:scale-105 transition-all'}>
                <div className="text-4xl mb-2">{room.icone}</div>
                <div className="text-white font-bold text-sm">{room.nom}</div>
              </div>
            ))}
          </div>
          <div className="bg-purple-900/40 p-6 rounded-xl border border-purple-500/30 mb-8">
            <h3 className="font-bold text-2xl mb-3 text-purple-300">üìã R√®gles :</h3>
            <ul className="list-disc list-inside space-y-2 text-lg text-gray-300">
              <li>4 rooms : 4 √©nigmes en 10 min</li>
              <li>Room 5 : Choisir le bon syst√®me de codage</li>
              <li>D√©crypter le message final !</li>
            </ul>
          </div>
          <button onClick={demarrerJeu} className="w-full bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 hover:from-purple-500 hover:via-pink-500 hover:to-red-500 text-white font-bold py-5 px-8 rounded-xl text-2xl transition-all hover:scale-105">
            üöÄ Commencer
          </button>
        </div>
      </div>
    );
  }

  if (ecran === 'room5Crypto') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-amber-900 via-yellow-900 to-black p-4">
        <div className="max-w-6xl mx-auto">
          <div className="bg-black/60 backdrop-blur-xl rounded-3xl p-8 border border-yellow-500/40">
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">üîë</div>
              <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                Room 5 : Syst√®mes de Codage
              </h1>
              <p className="text-xl text-gray-300">Choisissez le bon syst√®me pour d√©crypter le message !</p>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              {systemesCodeage.map((sys) => (
                <div key={sys.id} onClick={() => setChiffrementSelectionne(sys.id === chiffrementSelectionne ? null : sys.id)}
                  className={'cursor-pointer bg-gradient-to-br from-yellow-900/40 to-orange-900/40 p-6 rounded-2xl border-2 transition-all hover:scale-105 ' + 
                    (chiffrementSelectionne === sys.id ? 'border-yellow-400 shadow-lg' : 'border-gray-500')}>
                  <h3 className="text-2xl font-bold text-yellow-300 mb-3">{sys.nom}</h3>
                  <p className="text-gray-300 mb-4">{sys.description}</p>
                  <div className="bg-black/40 p-4 rounded-lg mb-4">
                    <p className="text-yellow-200 font-mono">{sys.exemple}</p>
                  </div>
                  {chiffrementSelectionne === sys.id && (
                    <button onClick={(e) => { e.stopPropagation(); essayerSysteme(sys.id); }}
                      className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-3 px-6 rounded-lg mt-4">
                      ‚úì Utiliser ce syst√®me
                    </button>
                  )}
                </div>
              ))}
            </div>
            <div className="bg-orange-900/30 border-2 border-orange-400 rounded-xl p-6 text-center">
              <p className="text-xl text-orange-300 font-bold">üí° Conseil :</p>
              <p className="text-gray-300 mt-2">Cliquez sur chaque syst√®me pour le d√©couvrir, puis choisissez celui qui vous semble correct !</p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (ecran === 'codeRoom') {
    const room = roomsConfig[roomActuelle];
    return (
      <div className={'min-h-screen bg-gradient-to-br ' + room.couleur + ' to-black flex items-center justify-center p-4'}>
        <div className="max-w-2xl w-full bg-black/60 backdrop-blur-xl rounded-3xl p-8 border border-white/30 text-center">
          <div className="text-7xl mb-6">{room.icone}</div>
          <h2 className="text-4xl font-bold mb-6 text-white">Room {roomActuelle + 1} Termin√©e !</h2>
          <div className="bg-green-900/40 border-2 border-green-400 rounded-2xl p-8 mb-8">
            <Key className="mx-auto text-yellow-400 mb-4" size={64} />
            <p className="text-2xl text-gray-300 mb-4">Code d'acc√®s :</p>
            <p className="text-6xl font-bold text-yellow-400 tracking-widest">{codesRooms[roomActuelle]}</p>
          </div>
          {roomActuelle < 4 ? (
            <div>
              <p className="text-xl text-gray-300 mb-6">Entrez ce code :</p>
              <input type="text" value={codeEntree} onChange={(e) => setCodeEntree(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && verifierCodeEntree()} placeholder="CODE..."
                className="w-full bg-gray-800 border-2 border-purple-500/50 rounded-xl px-6 py-4 text-white text-2xl text-center font-bold uppercase focus:outline-none mb-4" />
              {erreurCode && (
                <div className="flex items-center justify-center gap-2 text-red-400 mb-4">
                  <XCircle size={28} />
                  <span>Code incorrect !</span>
                </div>
              )}
              <button onClick={verifierCodeEntree} className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-4 px-8 rounded-xl text-xl">
                Valider
              </button>
            </div>
          ) : (
            <button onClick={() => setEcran('messageFinal')} className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-4 px-8 rounded-xl text-xl">
              D√©fi Final ‚Üí
            </button>
          )}
        </div>
      </div>
    );
  }

  if (ecran === 'messageFinal') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-yellow-900 via-orange-900 to-black flex items-center justify-center p-4">
        <div className="max-w-3xl w-full bg-black/60 backdrop-blur-xl rounded-3xl p-8 border border-yellow-500/40">
          <div className="text-center mb-8">
            <div className="text-6xl mb-4">üîì</div>
            <h2 className="text-5xl font-bold mb-6 bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">D√©fi Final</h2>
            <p className="text-xl text-green-400 font-bold">‚úÖ Bon syst√®me choisi ! Maintenant d√©cryptez :</p>
          </div>
          <div className="bg-orange-900/40 border-2 border-orange-400 rounded-2xl p-6 mb-8">
            <h3 className="text-2xl font-bold text-orange-300 mb-4">üîê Message Crypt√© :</h3>
            <div className="bg-black/60 p-6 rounded-lg">
              <p className="text-4xl font-mono text-white text-center">Csbwp wpvt bwfa nbjusjuf mb ufdiopophjf</p>
            </div>
          </div>
          <div className="bg-yellow-900/30 border-2 border-yellow-500/50 rounded-xl p-6 mb-8">
            <h3 className="text-2xl font-bold text-yellow-300 mb-3">üí° M√©thode C√©sar :</h3>
            <p className="text-gray-300 text-lg mb-3">D√©calage de <span className="text-yellow-400 font-bold">1 lettre vers la GAUCHE</span></p>
            <div className="bg-black/40 p-4 rounded-lg">
              <p className="text-center text-yellow-200 font-mono">B ‚Üí A, C ‚Üí B, D ‚Üí C...</p>
            </div>
          </div>
          <input type="text" value={messageDecrypte} onChange={(e) => setMessageDecrypte(e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && decrypterMessage()} placeholder="Message d√©crypt√©..."
            className="w-full bg-gray-800 border-2 border-yellow-500/50 rounded-xl px-6 py-4 text-white text-xl focus:outline-none mb-6" />
          <button onClick={decrypterMessage} className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-5 px-8 rounded-xl text-2xl">
            D√©crypter
          </button>
        </div>
      </div>
    );
  }

  if (ecran === 'victoire') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-green-900 via-emerald-900 to-black flex items-center justify-center p-4">
        <div className="max-w-3xl w-full bg-black/60 backdrop-blur-xl rounded-3xl p-8 border border-green-500/40 text-center">
          <div className="text-9xl mb-6">üéâ</div>
          <h1 className="text-7xl font-bold mb-6 bg-gradient-to-r from-green-400 via-emerald-400 to-cyan-400 bg-clip-text text-transparent">VICTOIRE !</h1>
          <div className="text-4xl text-white mb-8 font-bold">Bravo vous avez ma√Ætris√© la technologie</div>
          <div className="bg-green-900/40 border-2 border-green-400 rounded-2xl p-8 mb-8">
            <Trophy className="mx-auto text-yellow-400 mb-4" size={100} />
            <p className="text-3xl text-gray-300 mb-3">Temps total :</p>
            <p className="text-6xl font-bold text-yellow-400">{formatTemps(tempsTotal)}</p>
          </div>
          <button onClick={resetGame} className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-5 px-10 rounded-xl text-2xl">
            üîÑ Rejouer
          </button>
        </div>
      </div>
    );
  }

  const room = roomsConfig[roomActuelle];
  const enigme = enigmesSelectionnees[enigmeActuelle];
  const progression = (enigmesResolues.filter(Boolean).length / 4) * 100;

  return (
    <div className={'min-h-screen bg-gradient-to-br ' + room.couleur + ' to-black p-4'}>
      <div className="max-w-4xl mx-auto mb-6">
        <div className="bg-black/60 backdrop-blur-lg rounded-2xl p-5 border border-white/30">
          <div className="flex justify-between items-center mb-4">
            <div className="flex items-center gap-4">
              <div className="text-4xl">{room.icone}</div>
              <div>
                <div className="text-white font-bold text-2xl">Room {roomActuelle + 1}: {room.nom}</div>
                <div className="text-gray-300">√ânigme {enigmeActuelle + 1} / 4</div>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <Clock className={temps < 60 ? "text-red-400" : "text-yellow-400"} size={32} />
              <span className={'text-4xl font-bold ' + (temps < 60 ? 'text-red-400' : 'text-yellow-400')}>{formatTemps(temps)}</span>
            </div>
          </div>
          <div className="w-full bg-gray-700 rounded-full h-5">
            <div className="bg-gradient-to-r from-green-500 to-emerald-500 h-5 rounded-full transition-all" style={{ width: progression + '%' }} />
          </div>
        </div>
      </div>
      <div className="max-w-4xl mx-auto">
        <div className="bg-black/60 backdrop-blur-lg rounded-3xl p-8 border border-white/30">
          <div className="flex items-center gap-4 mb-6">
            <Lock className="text-white" size={40} />
            <h2 className="text-4xl font-bold text-white">√ânigme {enigmeActuelle + 1}</h2>
          </div>
          <div className="bg-white/10 p-8 rounded-2xl border border-white/20 mb-6">
            <p className="text-2xl text-white">{enigme.question}</p>
          </div>
          {indiceAffiche && (
            <div className="bg-yellow-900/40 border-2 border-yellow-500/50 p-5 rounded-lg mb-6 flex items-start gap-3">
              <Lightbulb className="text-yellow-400 flex-shrink-0 mt-1" size={28} />
              <p className="text-yellow-200 text-xl">üí° {enigme.indice}</p>
            </div>
          )}
          <div className="space-y-5">
            <input type={enigme.type} value={reponse} onChange={(e) => setReponse(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && verifierReponse()} disabled={enigmesResolues[enigmeActuelle]}
              placeholder="Votre r√©ponse..." className="w-full bg-gray-800 border-2 border-white/30 rounded-xl px-6 py-5 text-white text-2xl focus:outline-none disabled:opacity-50" />
            {erreur && (
              <div className="flex items-center gap-3 text-red-400 text-xl">
                <XCircle size={28} />
                <span>‚ùå Incorrect !</span>
              </div>
            )}
            {enigmesResolues[enigmeActuelle] && (
              <div className="flex items-center gap-3 text-green-400 text-xl">
                <CheckCircle size={28} />
                <span>‚úÖ R√©solue !</span>
              </div>
            )}
            <div className="flex gap-4">
              <button onClick={verifierReponse} disabled={enigmesResolues[enigmeActuelle] || !reponse}
                className="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 disabled:from-gray-600 disabled:to-gray-600 text-white font-bold py-5 px-6 rounded-xl text-xl disabled:cursor-not-allowed">
                Valider
              </button>
              {!indiceAffiche && !enigmesResolues[enigmeActuelle] && (
                <button onClick={() => setIndiceAffiche(true)} className="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-5 px-8 rounded-xl flex items-center gap-3">
                  <Lightbulb size={24} />
                  Indice
                </button>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
