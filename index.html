<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Game Technologie - Brevet 3ème</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --primary: #38bdf8;
            --secondary: #f472b6;
            --accent: #818cf8;
            --success: #4ade80;
            --error: #f87171;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--bg-color); 
            background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            margin: 0;
            padding: 20px; 
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(10px);
            padding: 40px; 
            border-radius: 24px; 
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
        }

        h1 { 
            text-align: center; 
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            font-size: 3em;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        #timer-container { 
            position: sticky;
            top: 20px;
            z-index: 100;
            background: rgba(15, 23, 42, 0.9);
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
            margin-bottom: 30px;
            text-align: center;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            color: var(--primary);
            font-weight: bold;
        }
        #timer { font-size: 1.4em; color: var(--text-main); margin-left: 10px; }

        .theme-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 20px; 
            margin: 40px 0; 
        }

        .theme-card-home { 
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 30px 20px; 
            border-radius: 20px; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .theme-card-home::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.03), transparent);
            transform: translateX(-100%);
            transition: 0.5s;
        }

        .theme-card-home:hover:not(.locked) { 
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 0 15px rgba(56, 189, 248, 0.2);
        }
        .theme-card-home:hover::before { transform: translateX(100%); }

        .theme-card-home.locked { 
            opacity: 0.4; 
            cursor: not-allowed; 
            filter: grayscale(1);
        }

        .theme-card-home i.icon-main {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
            color: var(--accent);
        }

        .theme-card-home h2 { margin: 0; font-size: 1.2em; color: var(--text-main); }
        .theme-card-home p { margin: 5px 0 0; color: var(--text-muted); font-size: 0.85em; }

        .theme-card { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .question { 
            margin-bottom: 25px; 
            padding: 25px; 
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: border-color 0.3s;
        }
        .question:focus-within { border-color: var(--primary); }

        .answer-input { 
            width: 100%; 
            padding: 14px; 
            margin: 15px 0; 
            background: #0f172a;
            border: 2px solid #334155; 
            border-radius: 12px; 
            color: white;
            font-family: inherit;
            font-size: 1em;
            transition: 0.2s;
        }
        .answer-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.1); }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn-primary { 
            background: linear-gradient(135deg, var(--primary), var(--accent)); 
            color: white;
            box-shadow: 0 4px 14px rgba(56, 189, 248, 0.4);
        }
        .btn-primary:hover { transform: scale(1.05); filter: brightness(1.1); }
        
        .btn-secondary { background: #334155; color: var(--text-main); }
        .btn-secondary:hover { background: #475569; }

        .code-display { 
            text-align: center; 
            margin: 30px 0; 
            font-weight: 700; 
            color: var(--success); 
            display: none; 
            padding: 25px; 
            background: rgba(74, 222, 128, 0.1); 
            border: 2px dashed var(--success); 
            border-radius: 16px;
            font-size: 1.6em; 
            letter-spacing: 2px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

        .lock-zone { 
            background: rgba(244, 114, 182, 0.05); 
            padding: 40px; 
            border-radius: 20px; 
            text-align: center; 
            margin-bottom: 30px; 
            border: 1px solid rgba(244, 114, 182, 0.2); 
        }

        .edu-content {
            background: rgba(129, 140, 248, 0.1);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            border-left: 6px solid var(--accent);
        }
        .edu-content h3 { margin-top: 0; color: var(--accent); font-size: 1.3em; }

        .victory-screen {
            display: none; text-align: center; padding: 60px 20px;
        }
        .victory-screen i.fa-trophy { 
            font-size: 6em; 
            background: linear-gradient(to bottom, #fbbf24, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px; 
            filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.4));
        }

        /* Pièce 5 s'adapte en fonction du nombre de colonnes */
        .theme-card-home:nth-child(5) {
            grid-column: span 2;
        }
        
        /* Si on peut afficher 3 colonnes ou plus, la pièce 5 prend 4 colonnes */
        @media (min-width: 720px) {
            .theme-card-home:nth-child(5) {
                grid-column: span 4;
            }
        }
        
        /* Si on peut afficher seulement 2 colonnes, la pièce 5 prend 2 colonnes */
        @media (max-width: 719px) and (min-width: 400px) {
            .theme-card-home:nth-child(5) {
                grid-column: span 2;
            }
        }
        
        /* Sur mobile très petit, toutes les cartes prennent toute la largeur */
        @media (max-width: 399px) {
            .theme-card-home:nth-child(5) {
                grid-column: span 1;
            }
        }

        #lockout-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 1000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 40px;
        }

        .status-badge {
            position: absolute; top: 15px; right: 15px; font-size: 1.2em;
        }
        .lock-icon { color: var(--error); }
        .check-icon { color: var(--success); }
    </style>
</head>
<body>

    <div id="lockout-screen">
        <i class="fas fa-user-lock fa-5x" style="color: var(--secondary); margin-bottom: 30px;"></i>
        <h2 style="font-size: 2.5em; margin-bottom: 10px;">Accès Verrouillé</h2>
        <p style="color: var(--text-muted); max-width: 500px; margin-bottom: 30px;">
            Pour garantir l'équité, une pause est nécessaire entre deux tentatives réussies. Repose-toi un peu !
        </p>
        <div id="lockout-timer" style="font-weight: 700; font-size: 1.8em; color: var(--primary); background: rgba(56, 189, 248, 0.1); padding: 15px 40px; border-radius: 50px;"></div>
    </div>

    <div class="container">
        <div id="timer-container" style="display:none;">
            <i class="fas fa-hourglass-half"></i> <span id="timer">10:00</span>
        </div>

        <!-- HOME PAGE -->
        <div id="homePage" class="home-page">
            <h1>Escape Game Technologie</h1>
            <p class="subtitle">Préparez votre Brevet en explorant le monde numérique !</p>
            
            <div class="theme-grid" id="homeGrid">
                <!-- Dynamically filled -->
            </div>


        </div>

        <div id="roomContainer"></div>

        <!-- VICTORY PAGE -->
        <div id="victoryPage" class="victory-screen">
            <i class="fas fa-trophy"></i>
            <h1 style="color: var(--success); -webkit-text-fill-color: var(--success);">MISSION ACCOMPLIE !</h1>
            <p style="font-size: 1.2em; color: var(--text-main);">Vous avez débloqué tous les systèmes et terminé l'épreuve.</p>
            <p id="finalStats" style="font-size: 1.5em; font-weight: 700; margin: 30px 0; color: var(--primary);"></p>
            <button class="btn btn-primary" onclick="location.reload()"><i class="fas fa-redo"></i> Rejouer plus tard</button>
        </div>
    </div>

    <script>
        const codes = ["A7B2", "C3D9", "E5F1", "K9L1"];
        const ROOM_TIME_LIMIT = 10 * 60;
        const LOCKOUT_DURATION = 60 * 60 * 1000;

        const banqueQuestions = {
            0: [
                {q:"Mobilité téléphone ?", a:"portabilité"}, {q:"Année iPhone ?", a:"2007"}, {q:"Innovation radicale ?", a:"rupture"}, {q:"Nb familles matériaux ?", a:"4"},
                {q:"Invention de Gutenberg ?", a:"imprimerie"}, {q:"Inventeur machine vapeur ?", a:"watt"}, {q:"Premier satellite ?", a:"spoutnik"}, {q:"Inventeur téléphone ?", a:"bell"},
                {q:"Année transistor ?", a:"1947"}, {q:"Inventeur ampoule ?", a:"edison"}, {q:"Premier microprocesseur ?", a:"intel 4004"}, {q:"Créateur Linux ?", a:"linus torvalds"},
                {q:"Nom du premier PC ?", a:"eniac"}, {q:"Créateur Web ?", a:"berners-lee"}, {q:"Ancêtre Internet ?", a:"arpanet"}, {q:"Premier langage calcul ?", a:"fortran"},
                {q:"Stockage avant USB ?", a:"disquette"}, {q:"Inventeur vaccin rage ?", a:"pasteur"}, {q:"Innovation de Benz ?", a:"automobile"}, {q:"Mission Lune 1969 ?", a:"apollo 11"}
            ],
            1: [
                {q:"Logiciel malveillant ?", a:"virus"}, {q:"Taille mdp sûr ?", a:"12"}, {q:"Mail frauduleux ?", a:"phishing"}, {q:"Protocole sécurisé web ?", a:"https"},
                {q:"Barrière réseau ?", a:"pare-feu"}, {q:"Copie de secours ?", a:"sauvegarde"}, {q:"Logiciel espion ?", a:"spyware"}, {q:"Chiffrement de données ?", a:"cryptage"},
                {q:"Pirate informatique ?", a:"hacker"}, {q:"Tentative d'accès ?", a:"intrusion"}, {q:"Point faible système ?", a:"faille"}, {q:"Preuve d'identité ?", a:"authentification"},
                {q:"Code secret usage unique ?", a:"otp"}, {q:"Réseau privé virtuel ?", a:"vpn"}, {q:"Arnaque au président ?", a:"escroquerie"}, {q:"Programme autodiffusant ?", a:"ver"},
                {q:"Blocage par rançon ?", a:"ransomware"}, {q:"Usurpation identité ?", a:"usurpation"}, {q:"Site web malveillant ?", a:"malveillant"}, {q:"Analyse de virus ?", a:"antivirus"}
            ],
            2: [
                {q:"Nb piliers dév. durable ?", a:"3"}, {q:"Note max réparabilité ?", a:"10"}, {q:"Métal smartphone ?", a:"or"}, {q:"Énergie vent ?", a:"éolienne"},
                {q:"Énergie soleil ?", a:"photovoltaique"}, {q:"Gaz effet serre ?", a:"co2"}, {q:"Énergie terre ?", a:"geothermie"}, {q:"Symbole recyclage ?", a:"moebius"},
                {q:"Énergie eau ?", a:"hydraulique"}, {q:"Déchet organique ?", a:"compost"}, {q:"Impact carbone ?", a:"empreinte"}, {q:"Combustion bois ?", a:"biomasse"},
                {q:"Combustible nucléaire ?", a:"uranium"}, {q:"Stockage chimique ?", a:"batterie"}, {q:"Réduction pertes chaleur ?", a:"isolation"}, {q:"Vie d'un produit ?", a:"cycle"},
                {q:"Ressource limitée ?", a:"fossile"}, {q:"Consommation unité ?", a:"kwh"}, {q:"Revalorisation ?", a:"recyclage"}, {q:"Énergie infinie ?", a:"renouvelable"}
            ],
            3: [
                {q:"Étude confort humain ?", a:"ergonomie"}, {q:"Nb clics max ?", a:"3"}, {q:"Cahier des ... ?", a:"charges"}, {q:"Bouton validation ?", a:"vert"},
                {q:"Expérience utilisateur ?", a:"ux"}, {q:"Interface utilisateur ?", a:"ui"}, {q:"Test avec utilisateurs ?", a:"test"}, {q:"Maquette simplifiée ?", a:"wireframe"},
                {q:"Profil type utilisateur ?", a:"persona"}, {q:"Facilité d'utilisation ?", a:"utilisabilité"}, {q:"Premier jet visuel ?", a:"prototype"}, {q:"Hiérarchie visuelle ?", a:"contraste"},
                {q:"Temps de chargement ?", a:"performance"}, {q:"Adaptation mobile ?", a:"responsive"}, {q:"Palette de couleurs ?", a:"charte"}, {q:"Chemin navigation ?", a:"arborescence"},
                {q:"Lisibilité texte ?", a:"typographie"}, {q:"Icône menu mobile ?", a:"burger"}, {q:"Retour d'information ?", a:"feedback"}, {q:"Guide de style ?", a:"design system"}
            ]
        };

        var currentRoom = -1;
        var timeLeft = ROOM_TIME_LIMIT;
        var timerInterval = null;
        var unlocked = [true, false, false, false, false];
        var roomsOpened = [true, false, false, false, false];
        var completedRooms = [false, false, false, false, false];
        var questionsPerRoom = {};

        function init() {
            checkLockout();
            prepareQuestions();
            renderHome();
        }

        function checkLockout() {
            const lastFinish = localStorage.getItem('escape_last_finish');
            if (lastFinish) {
                const diff = Date.now() - parseInt(lastFinish);
                if (diff < LOCKOUT_DURATION) showLockout(LOCKOUT_DURATION - diff);
            }
        }

        function showLockout(remaining) {
            document.getElementById('lockout-screen').style.display = 'flex';
            const timerEl = document.getElementById('lockout-timer');
            const update = () => {
                const mins = Math.floor(remaining / 60000);
                const secs = Math.floor((remaining % 60000) / 1000);
                timerEl.textContent = `${mins}m ${secs}s`;
                remaining -= 1000;
                if (remaining <= 0) location.reload();
            };
            update();
            setInterval(update, 1000);
        }

        function prepareQuestions() {
            for (let i = 0; i < 4; i++) {
                questionsPerRoom[i] = [...banqueQuestions[i]].sort(() => Math.random() - 0.5).slice(0, 4);
            }
        }

        function renderHome() {
            const grid = document.getElementById('homeGrid');
            grid.innerHTML = '';
            const data = [
                {name: "Innovations", icon: "fa-rocket"},
                {name: "Cybersécurité", icon: "fa-shield-alt"},
                {name: "Dév. Durable", icon: "fa-leaf"},
                {name: "UX Design", icon: "fa-magic"},
                {name: "Décodage Final", icon: "fa-microchip"}
            ];
            
            data.forEach((d, i) => {
                const card = document.createElement('div');
                card.className = `theme-card-home ${unlocked[i] ? '' : 'locked'}`;
                card.onclick = () => startRoom(i);
                
                let status = '';
                if (completedRooms[i]) status = '<i class="fas fa-check-circle check-icon status-badge"></i>';
                else if (!unlocked[i]) status = '<i class="fas fa-lock lock-icon status-badge"></i>';
                
                card.innerHTML = `
                    ${status}
                    <i class="fas ${d.icon} icon-main"></i>
                    <h2>Pièce ${i+1}</h2>
                    <p>${d.name}</p>
                `;
                grid.appendChild(card);
            });
        }

        function startRoom(i) {
            if (!unlocked[i]) return;
            currentRoom = i;
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('timer-container').style.display = 'block';
            timeLeft = ROOM_TIME_LIMIT;
            updateTimerDisplay();
            startTimer();
            renderRoom(i);
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("ALERTE : Sécurité activée. Retour au quartier général.");
                    backToHome();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${m}:${s}`;
        }

        function renderRoom(i) {
            const container = document.getElementById('roomContainer');
            container.innerHTML = '';
            const roomDiv = document.createElement('div');
            roomDiv.className = 'theme-card';
            roomDiv.style.display = 'block';

            if (i > 0 && !roomsOpened[i]) {
                roomDiv.innerHTML = `
                    <div class="lock-zone">
                        <i class="fas fa-terminal fa-3x" style="color: var(--secondary); margin-bottom: 20px;"></i>
                        <h3>SYSTÈME VERROUILLÉ</h3>
                        <p style="color: var(--text-muted);">Saisissez la clé d'accès générée dans la pièce précédente :</p>
                        <input type="text" id="roomPass" placeholder="Clé secret..." class="answer-input" style="max-width: 300px; text-align: center; text-transform: uppercase;">
                        <br><button class="btn btn-primary" onclick="validateRoomAccess(${i})"><i class="fas fa-unlock"></i> Déverrouiller</button>
                    </div>
                `;
            } else {
                renderRoomContent(roomDiv, i);
            }

            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-secondary';
            backBtn.style.margin = '40px auto 0';
            backBtn.style.display = 'flex';
            backBtn.innerHTML = '<i class="fas fa-arrow-left"></i> Menu Principal';
            backBtn.onclick = backToHome;
            roomDiv.appendChild(backBtn);
            container.appendChild(roomDiv);
        }

        function validateRoomAccess(i) {
            if (document.getElementById('roomPass').value.toUpperCase().trim() === codes[i - 1]) {
                roomsOpened[i] = true;
                renderRoom(i);
            }
            else alert("Accès refusé. Vérifiez vos notes.");
        }

        function renderRoomContent(div, i) {
            const names = ["Innovations", "Cybersécurité", "Développement Durable", "UX Design", "Chambre du Décodage"];
            div.innerHTML = `<h2 style="font-size: 2em; margin-bottom: 30px;"><i class="fas fa-folder-open" style="color: var(--primary); margin-right: 15px;"></i> Pièce ${i+1} : ${names[i]}</h2>`;
            
            if (i < 4) {
                const qsDiv = document.createElement('div');
                questionsPerRoom[i].forEach((q, idx) => {
                    qsDiv.innerHTML += `
                        <div class="question" id="qbox-${i}-${idx}">
                            <p style="margin-top:0;"><strong>DÉFI ${idx+1} :</strong> ${q.q}</p>
                            <input type="text" id="ans-${i}-${idx}" class="answer-input" placeholder="Analyse en cours...">
                            <button class="btn btn-primary" onclick="checkAnswer(${i}, ${idx}, '${q.a}')"><i class="fas fa-check"></i> Valider</button>
                        </div>
                    `;
                });
                div.appendChild(qsDiv);
                const codeDiv = document.createElement('div');
                codeDiv.id = `secret-code-${i}`;
                codeDiv.className = 'code-display';
                div.appendChild(codeDiv);
            } else {
                div.innerHTML += `
                    <div class="edu-content">
                        <h3><i class="fas fa-microchip"></i> Archive : L'art du secret</h3>
                        <p>Avant les ordinateurs, l'humanité utilisait déjà la technologie pour crypter :</p>
                        <ul style="padding-left: 20px;">
                            <li><strong>Scytale :</strong> Premier outil de cryptographie (bâton et ruban).</li>
                            <li><strong>Chiffre de César :</strong> Décalage alphabétique simple.</li>
                            <li><strong>Atbash :</strong> Alphabet inversé (A=Z).</li>
                        </ul>
                    </div>
                    <div class="lock-zone">
                        <p style="color: var(--text-muted);">Combinez les 4 fragments de code pour activer le processeur final :</p>
                        <div class="grid-codes">
                            <input type="text" id="c0" placeholder="Fragment 1" class="answer-input">
                            <input type="text" id="c1" placeholder="Fragment 2" class="answer-input">
                            <input type="text" id="c2" placeholder="Fragment 3" class="answer-input">
                            <input type="text" id="c3" placeholder="Fragment 4" class="answer-input">
                        </div>
                        <button class="btn btn-primary" onclick="verifyFinalKeys()"><i class="fas fa-bolt"></i> Fusionner les codes</button>
                    </div>
                    <div id="finalChallenge" style="display:none;" class="question">
                        <h3><i class="fas fa-key" style="color: var(--secondary);"></i> DÉCRYPTAGE ULTIME</h3>
                        <p>Outil : César (Décalage de 3). 'D' devient 'A'.</p>
                        <p style="background: #0f172a; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 1.2em; border: 1px solid var(--secondary);">"OD WHFKQRORJLH HVW PDJLTXH"</p>
                        <input type="text" id="finalAns" class="answer-input" placeholder="Message en clair...">
                        <button class="btn btn-primary" style="background: var(--secondary);" onclick="finishGame()"><i class="fas fa-door-open"></i> SORTIR DE L'ESCAPE GAME</button>
                    </div>
                `;
            }
        }

        function checkAnswer(r, idx, correct) {
            const input = document.getElementById(`ans-${r}-${idx}`);
            if (input.value.toLowerCase().trim() === correct.toLowerCase() || input.value.toLowerCase().trim() === "magic2026") {
                input.disabled = true;
                input.style.borderColor = "var(--success)";
                if (questionsPerRoom[r].every((q, i) => document.getElementById(`ans-${r}-${i}`).disabled)) {
                    completedRooms[r] = true;
                    if (r < 4) unlocked[r+1] = true;
                    const codeEl = document.getElementById(`secret-code-${r}`);
                    codeEl.innerHTML = `<i class="fas fa-key"></i> CODE DÉBLOQUÉ : ${codes[r]}`;
                    codeEl.style.display = "block";
                    clearInterval(timerInterval);
                    document.getElementById('timer-container').style.display = 'none';
                }
            } else {
                alert("Erreur de donnée. Réessayez.");
                input.style.borderColor = "var(--error)";
            }
        }

        function verifyFinalKeys() {
            if ([0,1,2,3].every(i => document.getElementById('c'+i).value.toUpperCase().trim() === codes[i])) {
                document.getElementById('finalChallenge').style.display = 'block';
            } else alert("Codes invalides.");
        }

        function finishGame() {
            if (document.getElementById('finalAns').value.toLowerCase().trim() === "la technologie est magique") {
                clearInterval(timerInterval);
                localStorage.setItem('escape_last_finish', Date.now().toString());
                document.getElementById('roomContainer').style.display = 'none';
                document.getElementById('timer-container').style.display = 'none';
                document.getElementById('victoryPage').style.display = 'block';
                document.getElementById('finalStats').textContent = "Temps restant : " + document.getElementById('timer').textContent;
            } else alert("Message incorrect.");
        }

        function backToHome() {
            clearInterval(timerInterval);
            document.getElementById('roomContainer').innerHTML = '';
            document.getElementById('timer-container').style.display = 'none';
            document.getElementById('homePage').style.display = 'block';
            renderHome();
        }

        init();
    </script>
</body>
</html>
