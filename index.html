<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Game Technologie - Tournoi Brevet</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'orbitron': ['Orbitron', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .text-gradient {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981, #059669);
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .room-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .room-card:hover {
            transform: translateY(-5px);
        }
        
        .timer-warning {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .victory-animation {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Configuration du jeu
        const CONFIG = {
            TEMPS_PAR_ROOM: 600, // 10 minutes en secondes
            FORM_LINK: "https://forms.gle/" // √Ä REMPLACER PAR VOTRE LIEN
        };

        // Banque d'√©nigmes
        const BANQUE_ENIGMES = {
            evolution: [
                { question: "Quelle innovation a permis de passer du t√©l√©phone fixe au mobile ?", reponse: "portabilite", indice: "Ce qui permet de d√©placer" },
                { question: "En quelle ann√©e le premier iPhone est-il sorti ?", reponse: "2007", indice: "Entre 2000 et 2010" },
                { question: "Comment appelle-t-on une innovation qui change radicalement un march√© ?", reponse: "rupture", indice: "Innovation de..." },
                { question: "Quelle est la famille de mat√©riaux la plus l√©g√®re ?", reponse: "plastique", indice: "D√©riv√© du p√©trole" }
            ],
            cybersecurite: [
                { question: "Comment appelle-t-on un programme malveillant ?", reponse: "virus", indice: "Comme une maladie" },
                { question: "Combien de caract√®res min pour un mot de passe s√ªr ?", reponse: "12", indice: "Plus de 10" },
                { question: "Comment s'appelle l'usurpation d'identit√© par email ?", reponse: "phishing", indice: "Commence par 'ph'" },
                { question: "Quelle technique crypte un fichier ?", reponse: "chiffrement", indice: "Rendre illisible" }
            ],
            durable: [
                { question: "Combien de piliers du d√©veloppement durable ?", reponse: "3", indice: "√âconomique, social..." },
                { question: "Sur combien est not√© l'indice de r√©parabilit√© ?", reponse: "10", indice: "Comme une note" },
                { question: "Quel m√©tal pr√©cieux dans les smartphones ?", reponse: "or", indice: "M√©tal jaune" },
                { question: "Quelle √©nergie provient du soleil ?", reponse: "solaire", indice: "√ânergie..." }
            ],
            utilisateur: [
                { question: "Comment s'appelle l'√©tude de l'adaptation √† l'humain ?", reponse: "ergonomie", indice: "Science du confort" },
                { question: "Combien de clics max pour acc√©der √† une info ?", reponse: "3", indice: "R√®gle des ... clics" },
                { question: "Comment s'appelle le document qui liste les exigences ?", reponse: "cahier", indice: "... des charges" },
                { question: "Quelle couleur pour les boutons de validation ?", reponse: "vert", indice: "Feu pour avancer" }
            ]
        };

        const ROOMS_CONFIG = [
            { nom: "√âvolution Technologique", theme: "evolution", couleur: "from-purple-900 to-blue-900", icone: "üî¨" },
            { nom: "Cybers√©curit√©", theme: "cybersecurite", couleur: "from-red-900 to-orange-900", icone: "üîê" },
            { nom: "D√©veloppement Durable", theme: "durable", couleur: "from-green-900 to-emerald-900", icone: "üåç" },
            { nom: "Exp√©rience Utilisateur", theme: "utilisateur", couleur: "from-blue-900 to-cyan-900", icone: "üë§" },
            { nom: "D√©cryptage Final", theme: "crypto", couleur: "from-amber-900 to-yellow-900", icone: "üîë" }
        ];

        // Application principale
        class EscapeGame {
            constructor() {
                this.ecran = 'accueil';
                this.roomActuelle = 0;
                this.temps = CONFIG.TEMPS_PAR_ROOM;
                this.enigmeActuelle = 0;
                this.enigmesSelectionnees = [];
                this.reponse = '';
                this.erreur = false;
                this.enigmesResolues = [false, false, false, false];
                this.indiceAffiche = false;
                this.codesRooms = [];
                this.codeEntree = '';
                this.erreurCode = false;
                this.messageDecrypte = '';
                this.tempsTotal = 0;
                
                // Tournoi
                this.tournoiNom = '';
                this.tournoiClasse = '';
                this.classementLocal = this.getClassementLocal();
                
                this.timerInterval = null;
                this.init();
            }
            
            init() {
                this.render();
                this.setupEventListeners();
            }
            
            // Gestion du classement local
            getClassementLocal() {
                try {
                    const stored = localStorage.getItem('escapeGameLocal');
                    return stored ? JSON.parse(stored) : [];
                } catch {
                    return [];
                }
            }
            
            sauvegarderScoreLocal() {
                if (!this.tournoiNom.trim() || !this.tournoiClasse.trim()) {
                    alert('Veuillez entrer votre nom et classe !');
                    return false;
                }
                
                const score = {
                    id: Date.now(),
                    nom: this.tournoiNom,
                    classe: this.tournoiClasse,
                    temps: this.formatTemps(this.tempsTotal),
                    tempsSecondes: this.tempsTotal,
                    date: new Date().toLocaleString('fr-FR')
                };
                
                const classementActuel = this.getClassementLocal();
                classementActuel.push(score);
                classementActuel.sort((a, b) => a.tempsSecondes - b.tempsSecondes);
                
                const top50 = classementActuel.slice(0, 50);
                localStorage.setItem('escapeGameLocal', JSON.stringify(top50));
                this.classementLocal = top50;
                
                alert(`‚úÖ Score enregistr√© localement !\n\nüì∏ Prenez une capture d'√©cran\nüìù Remplissez le formulaire : ${CONFIG.FORM_LINK}\nüèÜ Attendez les r√©sultats !`);
                
                return true;
            }
            
            exporterCSV() {
                if (this.classementLocal.length === 0) {
                    alert('Aucun score √† exporter !');
                    return;
                }
                
                const csvHeader = 'Position,Nom,Classe,Temps,Date\n';
                const csvRows = this.classementLocal.map((score, index) => 
                    `${index + 1},"${score.nom}","${score.classe}",${score.temps},"${score.date}"`
                ).join('\n');
                
                const csvContent = csvHeader + csvRows;
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `classement_escape_${Date.now()}.csv`;
                a.click();
            }
            
            resetClassementLocal() {
                if (confirm('Vider tous les scores de ce poste ?')) {
                    localStorage.removeItem('escapeGameLocal');
                    this.classementLocal = [];
                    alert('Classement local vid√© !');
                    this.render();
                }
            }
            
            // Fonctions du jeu
            tirerEnigmes(theme) {
                const banque = [...BANQUE_ENIGMES[theme]];
                return banque.sort(() => Math.random() - 0.5).slice(0, 4);
            }
            
            genererCode(index) {
                const prefixes = ['EVO', 'CYB', 'DUR', 'UX', 'CRY'];
                return prefixes[index] + Math.floor(1000 + Math.random() * 9000);
            }
            
            formatTemps(secondes) {
                const mins = Math.floor(secondes / 60);
                const secs = secondes % 60;
                return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
            }
            
            demarrerJeu() {
                this.codesRooms = [0, 1, 2, 3, 4].map(i => this.genererCode(i));
                this.demarrerRoom(0);
            }
            
            demarrerRoom(index) {
                if (index === 4) {
                    this.roomActuelle = index;
                    this.temps = CONFIG.TEMPS_PAR_ROOM;
                    this.ecran = 'room5Crypto';
                } else {
                    this.enigmesSelectionnees = this.tirerEnigmes(ROOMS_CONFIG[index].theme);
                    this.roomActuelle = index;
                    this.enigmeActuelle = 0;
                    this.enigmesResolues = [false, false, false, false];
                    this.temps = CONFIG.TEMPS_PAR_ROOM;
                    this.reponse = '';
                    this.erreur = false;
                    this.indiceAffiche = false;
                    this.ecran = 'room';
                    this.startTimer();
                }
                this.render();
            }
            
            startTimer() {
                if (this.timerInterval) clearInterval(this.timerInterval);
                
                this.timerInterval = setInterval(() => {
                    if (this.temps > 0) {
                        this.temps--;
                        this.tempsTotal++;
                        this.renderTimer();
                    } else {
                        clearInterval(this.timerInterval);
                        alert('Temps √©coul√© !');
                        this.ecran = 'accueil';
                        this.render();
                    }
                }, 1000);
            }
            
            renderTimer() {
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.textContent = this.formatTemps(this.temps);
                    if (this.temps < 60) {
                        timerElement.classList.add('text-red-500', 'timer-warning');
                    } else {
                        timerElement.classList.remove('text-red-500', 'timer-warning');
                    }
                }
            }
            
            verifierReponse() {
                const enigme = this.enigmesSelectionnees[this.enigmeActuelle];
                if (this.reponse.toLowerCase().trim() === enigme.reponse.toLowerCase()) {
                    this.enigmesResolues[this.enigmeActuelle] = true;
                    this.erreur = false;
                    
                    if (this.enigmesResolues.every(r => r)) {
                        setTimeout(() => {
                            this.ecran = 'codeRoom';
                            this.render();
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            this.enigmeActuelle++;
                            this.reponse = '';
                            this.indiceAffiche = false;
                            this.render();
                        }, 1000);
                    }
                } else {
                    this.erreur = true;
                }
                this.render();
            }
            
            verifierCodeEntree() {
                if (this.codeEntree.toUpperCase() === this.codesRooms[this.roomActuelle]) {
                    this.codeEntree = '';
                    this.erreurCode = false;
                    if (this.roomActuelle < 4) {
                        this.demarrerRoom(this.roomActuelle + 1);
                    } else {
                        this.ecran = 'messageFinal';
                        this.render();
                    }
                } else {
                    this.erreurCode = true;
                    this.render();
                }
            }
            
            decrypterMessage() {
                if (this.messageDecrypte.toLowerCase().trim() === "bravo vous avez maitrise la technologie") {
                    this.ecran = 'victoire';
                    if (this.timerInterval) clearInterval(this.timerInterval);
                } else {
                    alert("Ce n'est pas la bonne r√©ponse. R√©essayez !");
                }
                this.render();
            }
            
            // Rendu des √©crans
            render() {
                const app = document.getElementById('app');
                
                switch(this.ecran) {
                    case 'accueil':
                        app.innerHTML = this.renderAccueil();
                        break;
                    case 'room':
                        app.innerHTML = this.renderRoom();
                        break;
                    case 'room5Crypto':
                        app.innerHTML = this.renderRoom5Crypto();
                        break;
                    case 'codeRoom':
                        app.innerHTML = this.renderCodeRoom();
                        break;
                    case 'messageFinal':
                        app.innerHTML = this.renderMessageFinal();
                        break;
                    case 'victoire':
                        app.innerHTML = this.renderVictoire();
                        break;
                }
                
                this.setupEventListeners();
            }
            
            renderAccueil() {
                const top5 = this.classementLocal.slice(0, 5);
                
                return `
                    <div class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-black p-4 md:p-8">
                        <div class="max-w-6xl mx-auto">
                            <!-- En-t√™te -->
                            <div class="text-center mb-8 md:mb-12">
                                <h1 class="text-4xl md:text-6xl font-bold mb-4 text-gradient font-orbitron">
                                    üéÆ ESCAPE GAME TECHNOLOGIE
                                </h1>
                                <p class="text-xl text-gray-300">5 salles pour r√©viser le Brevet - Tournoi inter-classes</p>
                            </div>
                            
                            <!-- Instructions tournoi -->
                            <div class="glass-panel rounded-2xl p-6 mb-8 border border-yellow-500/30">
                                <h2 class="text-2xl font-bold text-yellow-400 mb-4">üèÜ TOURNOI INTER-CLASSES</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-gray-300 mb-2">üì∏ <strong>Capture d'√©cran obligatoire</strong></p>
                                        <p class="text-gray-300 mb-2">üìù <strong>Formulaire unique :</strong></p>
                                        <a href="${CONFIG.FORM_LINK}" target="_blank" class="text-blue-400 underline break-all">${CONFIG.FORM_LINK}</a>
                                    </div>
                                    <div>
                                        <p class="text-gray-300 mb-2">‚è±Ô∏è <strong>10 minutes par salle</strong></p>
                                        <p class="text-gray-300">üèÖ <strong>Classements par classe</strong></p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Salles -->
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
                                ${ROOMS_CONFIG.map((room, i) => `
                                    <div class="room-card bg-gradient-to-br ${room.couleur} p-4 rounded-xl border border-white/20 text-center">
                                        <div class="text-3xl mb-2">${room.icone}</div>
                                        <div class="text-white font-bold text-sm">${room.nom}</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <!-- Top 5 local -->
                            ${top5.length > 0 ? `
                                <div class="glass-panel rounded-2xl p-6 mb-8">
                                    <h3 class="text-xl font-bold text-purple-400 mb-4 text-center">üèÜ TOP 5 - CE POSTE</h3>
                                    <div class="space-y-2">
                                        ${top5.map((score, index) => `
                                            <div class="flex justify-between items-center p-3 rounded-lg ${
                                                index === 0 ? 'bg-yellow-900/30' :
                                                index === 1 ? 'bg-gray-800/30' :
                                                index === 2 ? 'bg-orange-900/30' :
                                                'bg-slate-800/30'
                                            }">
                                                <div class="flex items-center">
                                                    <span class="w-8 h-8 flex items-center justify-center rounded-full mr-3 ${
                                                        index === 0 ? 'bg-yellow-500 text-black' :
                                                        index === 1 ? 'bg-gray-400 text-black' :
                                                        index === 2 ? 'bg-orange-600' :
                                                        'bg-slate-700'
                                                    }">
                                                        ${index === 0 ? 'üëë' : index + 1}
                                                    </span>
                                                    <div>
                                                        <p class="font-bold">${score.nom}</p>
                                                        <p class="text-sm text-gray-400">${score.classe}</p>
                                                    </div>
                                                </div>
                                                <div class="font-mono font-bold">${score.temps}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Bouton d√©marrer -->
                            <div class="text-center">
                                <button onclick="game.demarrerJeu()" class="btn-primary text-white font-bold py-4 px-12 rounded-xl text-2xl w-full max-w-md">
                                    üöÄ COMMENCER LE JEU
                                </button>
                                
                                <!-- Mode Admin -->
                                <div class="mt-6">
                                    <button onclick="game.exporterCSV()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg mr-2">
                                        üì• Exporter CSV
                                    </button>
                                    <button onclick="game.resetClassementLocal()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg">
                                        ‚ôªÔ∏è R√©initialiser
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderRoom() {
                const room = ROOMS_CONFIG[this.roomActuelle];
                const enigme = this.enigmesSelectionnees[this.enigmeActuelle];
                const progression = (this.enigmesResolues.filter(Boolean).length / 4) * 100;
                
                return `
                    <div class="min-h-screen bg-gradient-to-br ${room.couleur} p-4 md:p-8">
                        <div class="max-w-4xl mx-auto">
                            <!-- En-t√™te -->
                            <div class="glass-panel rounded-2xl p-6 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="flex items-center gap-4">
                                        <div class="text-3xl">${room.icone}</div>
                                        <div>
                                            <h2 class="text-2xl font-bold text-white">Room ${this.roomActuelle + 1}: ${room.nom}</h2>
                                            <p class="text-gray-300">√ânigme ${this.enigmeActuelle + 1} / 4</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl">‚è±Ô∏è</span>
                                        <span id="timer" class="text-3xl font-bold font-mono ${
                                            this.temps < 60 ? 'text-red-500 timer-warning' : 'text-yellow-400'
                                        }">
                                            ${this.formatTemps(this.temps)}
                                        </span>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-500"
                                         style="width: ${progression}%"></div>
                                </div>
                            </div>
                            
                            <!-- √ânigme -->
                            <div class="glass-panel rounded-2xl p-6 md:p-8">
                                <div class="mb-6">
                                    <h3 class="text-2xl font-bold text-white mb-4">√ânigme ${this.enigmeActuelle + 1}</h3>
                                    <div class="bg-white/10 p-6 rounded-xl border border-white/20">
                                        <p class="text-xl text-white">${enigme.question}</p>
                                    </div>
                                </div>
                                
                                ${this.indiceAffiche ? `
                                    <div class="bg-yellow-900/30 p-4 rounded-xl border border-yellow-500/50 mb-6">
                                        <p class="text-yellow-300">üí° ${enigme.indice}</p>
                                    </div>
                                ` : ''}
                                
                                <div class="space-y-4">
                                    <input type="text" 
                                           id="reponseInput"
                                           value="${this.reponse}"
                                           placeholder="Votre r√©ponse..."
                                           class="w-full p-4 bg-gray-800 border-2 border-white/30 rounded-xl text-white text-lg focus:outline-none focus:border-blue-500"
                                           ${this.enigmesResolues[this.enigmeActuelle] ? 'disabled' : ''}>
                                    
                                    ${this.erreur ? `
                                        <div class="text-red-400 flex items-center gap-2">
                                            <span>‚ùå</span>
                                            <span>R√©ponse incorrecte !</span>
                                        </div>
                                    ` : ''}
                                    
                                    ${this.enigmesResolues[this.enigmeActuelle] ? `
                                        <div class="text-green-400 flex items-center gap-2">
                                            <span>‚úÖ</span>
                                            <span class="font-bold">√ânigme r√©solue !</span>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="flex gap-4">
                                        <button onclick="game.verifierReponse()" 
                                                ${this.enigmesResolues[this.enigmeActuelle] || !this.reponse ? 'disabled' : ''}
                                                class="btn-success text-white font-bold py-4 px-8 rounded-xl flex-1 ${
                                                    this.enigmesResolues[this.enigmeActuelle] || !this.reponse ? 'opacity-50 cursor-not-allowed' : ''
                                                }">
                                            Valider
                                        </button>
                                        
                                        ${!this.indiceAffiche && !this.enigmesResolues[this.enigmeActuelle] ? `
                                            <button onclick="game.indiceAffiche = true; game.render();" 
                                                    class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-4 px-6 rounded-xl">
                                                üí° Indice
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderRoom5Crypto() {
                const systemes = [
                    { id: 'cesar', nom: 'Chiffre de C√©sar', description: 'D√©calage de lettres', exemple: 'A ‚Üí D (+3)', correct: true },
                    { id: 'atbash', nom: 'Atbash', description: 'Alphabet invers√©', exemple: 'A ‚Üí Z, B ‚Üí Y', correct: false },
                    { id: 'morse', nom: 'Code Morse', description: 'Points et traits', exemple: 'A = .-', correct: false },
                    { id: 'binaire', nom: 'Binaire', description: '0 et 1', exemple: 'A = 01000001', correct: false }
                ];
                
                return `
                    <div class="min-h-screen bg-gradient-to-br from-amber-900 to-yellow-900 p-4 md:p-8">
                        <div class="max-w-6xl mx-auto">
                            <div class="glass-panel rounded-3xl p-6 md:p-8">
                                <div class="text-center mb-8">
                                    <div class="text-6xl mb-4">üîë</div>
                                    <h1 class="text-4xl font-bold mb-4 text-gradient font-orbitron">ROOM 5 : SYST√àMES DE CODAGE</h1>
                                    <p class="text-xl text-gray-300">Choisis le bon syst√®me pour d√©crypter le message !</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                    ${systemes.map(sys => `
                                        <div class="cursor-pointer bg-gradient-to-br from-yellow-900/40 to-orange-900/40 p-6 rounded-2xl border-2 ${
                                            this.chiffrementSelectionne === sys.id ? 'border-yellow-400' : 'border-gray-500'
                                        } hover:border-yellow-400 transition-all"
                                             onclick="game.chiffrementSelectionne = '${sys.id}'; game.render();">
                                            <h3 class="text-2xl font-bold text-yellow-300 mb-3">${sys.nom}</h3>
                                            <p class="text-gray-300 mb-4">${sys.description}</p>
                                            <div class="bg-black/40 p-4 rounded-lg">
                                                <p class="text-yellow-200 font-mono">${sys.exemple}</p>
                                            </div>
                                            ${this.chiffrementSelectionne === sys.id ? `
                                                <button onclick="if('${sys.correct}' === 'true') { game.ecran = 'messageFinal'; game.render(); } else { alert('‚ùå Ce syst√®me ne fonctionne pas !'); }"
                                                        class="w-full mt-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-3 px-6 rounded-lg">
                                                    ‚úì Essayer ce syst√®me
                                                </button>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderCodeRoom() {
                const room = ROOMS_CONFIG[this.roomActuelle];
                const estDerniereRoom = this.roomActuelle === 4;
                
                return `
                    <div class="min-h-screen bg-gradient-to-br ${room.couleur} flex items-center justify-center p-4">
                        <div class="max-w-2xl w-full glass-panel rounded-3xl p-8 text-center">
                            <div class="text-7xl mb-6">${room.icone}</div>
                            <h2 class="text-4xl font-bold mb-6 text-white">ROOM ${this.roomActuelle + 1} TERMIN√âE !</h2>
                            
                            <div class="bg-green-900/40 border-2 border-green-400 rounded-2xl p-8 mb-8">
                                <div class="text-6xl mb-4">üîë</div>
                                <p class="text-2xl text-gray-300 mb-4">Code d'acc√®s :</p>
                                <p class="text-5xl font-bold text-yellow-400 font-mono">${this.codesRooms[this.roomActuelle]}</p>
                            </div>
                            
                            ${!estDerniereRoom ? `
                                <div>
                                    <p class="text-xl text-gray-300 mb-6">Entre ce code pour la room suivante :</p>
                                    <input type="text" 
                                           id="codeInput"
                                           value="${this.codeEntree}"
                                           placeholder="CODE..."
                                           class="w-full p-4 bg-gray-800 border-2 border-purple-500/50 rounded-xl text-white text-2xl text-center font-bold uppercase focus:outline-none mb-4">
                                    
                                    ${this.erreurCode ? `
                                        <div class="text-red-400 mb-4">
                                            ‚ùå Code incorrect !
                                        </div>
                                    ` : ''}
                                    
                                    <button onclick="game.verifierCodeEntree()"
                                            class="w-full btn-success text-white font-bold py-4 px-8 rounded-xl text-xl">
                                        Valider le Code
                                    </button>
                                </div>
                            ` : `
                                <button onclick="game.ecran = 'messageFinal'; game.render();"
                                        class="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-4 px-8 rounded-xl text-xl">
                                    D√©fi Final ‚Üí
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }
            
            renderMessageFinal() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-yellow-900 to-orange-900 flex items-center justify-center p-4">
                        <div class="max-w-3xl w-full glass-panel rounded-3xl p-8">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">üîì</div>
                                <h2 class="text-4xl font-bold mb-6 text-gradient font-orbitron">D√âFI FINAL</h2>
                                <p class="text-xl text-green-400 font-bold">‚úÖ Syst√®me correct ! Maintenant d√©crypte :</p>
                            </div>
                            
                            <div class="bg-orange-900/40 border-2 border-orange-400 rounded-2xl p-6 mb-8">
                                <h3 class="text-2xl font-bold text-orange-300 mb-4">üîê Message Crypt√© :</h3>
                                <div class="bg-black/60 p-6 rounded-lg">
                                    <p class="text-3xl font-mono text-white text-center">Csbwp wpvt bwfa nbjusjuf mb ufdiopophjf</p>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-900/30 border-2 border-yellow-500/50 rounded-xl p-6 mb-8">
                                <h3 class="text-2xl font-bold text-yellow-300 mb-3">üí° M√©thode C√©sar :</h3>
                                <p class="text-gray-300 text-lg mb-3">D√©calage de <span class="text-yellow-400 font-bold">1 lettre vers la GAUCHE</span></p>
                                <div class="bg-black/40 p-4 rounded-lg">
                                    <p class="text-center text-yellow-200 font-mono">B ‚Üí A, C ‚Üí B, D ‚Üí C...</p>
                                </div>
                            </div>
                            
                            <input type="text" 
                                   id="messageInput"
                                   value="${this.messageDecrypte}"
                                   placeholder="Message d√©crypt√©..."
                                   class="w-full p-4 bg-gray-800 border-2 border-yellow-500/50 rounded-xl text-white text-xl focus:outline-none mb-6">
                            
                            <button onclick="game.decrypterMessage()"
                                    class="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-4 px-8 rounded-xl text-2xl">
                                D√©crypter
                            </button>
                        </div>
                    </div>
                `;
            }
            
            renderVictoire() {
                const position = this.classementLocal.findIndex(s => s.temps === this.formatTemps(this.tempsTotal)) + 1;
                const estSurPodium = position <= 3;
                
                return `
                    <div class="min-h-screen bg-gradient-to-br from-green-900 to-emerald-900 p-4 md:p-8">
                        <div class="max-w-6xl mx-auto">
                            <div class="glass-panel rounded-3xl p-8">
                                <!-- Animation victoire -->
                                <div class="text-center mb-8">
                                    <div class="text-9xl mb-6 victory-animation">üéâ</div>
                                    <h1 class="text-6xl font-bold mb-6 text-gradient font-orbitron">VICTOIRE !</h1>
                                    <div class="text-3xl text-white mb-8 font-bold">
                                        Bravo vous avez ma√Ætris√© la technologie
                                    </div>
                                </div>
                                
                                <!-- Temps et classement -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                                    <!-- Temps -->
                                    <div class="bg-green-900/40 border-2 border-green-400 rounded-2xl p-8">
                                        <div class="text-center">
                                            <div class="text-6xl mb-4">üèÜ</div>
                                            <p class="text-2xl text-gray-300 mb-3">Votre temps :</p>
                                            <p class="text-5xl font-bold text-yellow-400 font-mono mb-6">
                                                ${this.formatTemps(this.tempsTotal)}
                                            </p>
                                            
                                            ${this.classementLocal.length > 0 ? `
                                                <div class="mt-6 p-4 bg-slate-800/40 rounded-xl">
                                                    <p class="text-xl text-gray-300 mb-2">üìä Sur ce poste :</p>
                                                    ${estSurPodium ? `
                                                        <div class="text-center p-4 bg-yellow-900/30 rounded-lg">
                                                            <p class="text-2xl text-yellow-300 font-bold mb-2">
                                                                ${position === 1 ? 'ü•á CHAMPION LOCAL !' :
                                                                  position === 2 ? 'ü•à 2√àME LOCAL !' : 'ü•â 3√àME LOCAL !'}
                                                            </p>
                                                            <p class="text-lg">Position ${position
